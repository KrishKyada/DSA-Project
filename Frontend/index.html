<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>üß† CodePlag Analyzer ‚Äî C++ DSA Edition</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/codemirror.min.css"
  />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/codemirror.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/clike/clike.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    /* üåô Keep all your theme and colors unchanged */
    :root {
      --bg: #0d1117;
      --panel: #161b22;
      --card: #1f2937;
      --ink: #f8fafc;
      --muted: #cbd5e1;
      --accent: #6366f1;
      --good: #22c55e;
      --error: #ef4444;
      --line: #2d3748;
      --result-bg: linear-gradient(145deg, #1a2235, #111827);
    }

    body.light {
      --bg: #f9fafb;
      --panel: #ffffff;
      --card: #f1f5f9;
      --ink: #1e293b;
      --muted: #6b7280;
      --accent: #4f46e5;
      --good: #16a34a;
      --error: #dc2626;
      --line: #e5e7eb;
      --result-bg: linear-gradient(145deg, #ffffff, #f3f4f6);
    }

    * {
      box-sizing: border-box;
      transition: all 0.3s ease;
    }

    html,
    body {
      height: 100%;
      margin: 0;
      font-family: "Inter", sans-serif;
      background: var(--bg);
      color: var(--ink);
      overflow: hidden;
    }

    /* ===================== LAYOUT CHANGES ===================== */
    main {
      display: flex;
      height: calc(100vh - 120px);
      overflow: hidden;
    }

    .left {
      flex: 2;
      overflow-y: auto;
      padding: 20px;
    }

    .right {
      flex: 1;
      background: var(--result-bg);
      border-left: 1px solid var(--line);
      box-shadow: -5px 0 20px rgba(0, 0, 0, 0.4);
      transform: translateX(100%);
      transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
      padding: 20px;
      overflow-y: auto;
    }

    .right.active {
      transform: translateX(0);
    }

    /* ===================== ORIGINAL STYLING BELOW ===================== */
    header {
      text-align: center;
      padding: 28px 16px;
      background: linear-gradient(135deg, var(--accent), var(--card));
      color: white;
      box-shadow: 0 3px 15px rgba(0, 0, 0, 0.4);
    }

    h1 {
      margin: 0;
      font-size: 2rem;
    }

    .controls {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 12px;
      margin-bottom: 20px;
    }

    .control-box {
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
      align-items: end;
      background: var(--panel);
      padding: 16px 20px;
      border-radius: 16px;
      border: 1px solid var(--line);
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.25);
    }

    .field {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    label {
      color: var(--ink);
      font-weight: 600;
    }

    input[type="number"] {
      padding: 8px 10px;
      background: var(--card);
      color: var(--ink);
      border: 1px solid var(--line);
      border-radius: 8px;
      width: 90px;
    }

    button {
      background: var(--accent);
      border: none;
      color: white;
      font-weight: 600;
      border-radius: 10px;
      padding: 10px 18px;
      cursor: pointer;
    }

    button.secondary {
      background: var(--muted);
      color: var(--bg);
    }

    .panes {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }

    .CodeMirror {
      height: 320px;
      border-radius: 12px;
      border: 1px solid var(--line);
      background: var(--panel);
      font-size: 14px;
      color: var(--ink);
    }

    .result {
      padding: 20px 24px;
      border-radius: 18px;
      background: var(--result-bg);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
      border: 1px solid rgba(99, 102, 241, 0.3);
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 12px;
      margin-bottom: 16px;
    }

    .card {
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 12px;
      padding: 14px;
      text-align: center;
      color: var(--ink);
      box-shadow: 0 3px 6px rgba(0, 0, 0, 0.2);
    }

    .card.highlight {
      border-color: var(--accent);
      background: rgba(99, 102, 241, 0.18);
      box-shadow: 0 0 10px rgba(99, 102, 241, 0.35);
    }

    .card .label {
      font-size: 12px;
      color: var(--muted);
    }

    .card .value {
      font-weight: 700;
      font-size: 1.1rem;
      margin-top: 4px;
    }

    .big {
      font-size: 1.4rem;
    }

    .msg {
      background: var(--panel);
      border: 1px dashed var(--line);
      border-radius: 10px;
      padding: 10px;
      color: var(--ink);
      font-size: 0.9rem;
    }

    .bar {
      height: 12px;
      background: var(--card);
      border-radius: 999px;
      overflow: hidden;
      border: 1px solid var(--line);
      margin-top: 12px;
    }

    #barFill {
      height: 100%;
      width: 0%;
      background: var(--accent);
      transition: width 0.4s ease-in-out;
    }

    #gaugeCanvas {
      max-width: 160px;
      margin: 10px auto;
    }

    footer {
      text-align: center;
      padding: 12px;
      color: var(--muted);
    }

    .hidden {
      display: none;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }
  </style>
</head>

<body>
  <header>
    <h1>üß† CodePlag Analyzer</h1>
    <p>Winnowing ¬∑ Edit Distance ¬∑ AST ¬∑ C++ Analysis</p>
    <button id="themeToggle" class="small-btn">üåó Toggle Theme</button>
  </header>

  <main>
    <div class="left">
      <section class="controls">
        <div class="control-box">
          <div class="field">
            <label>k-gram</label>
            <input id="k" type="number" min="2" value="5" />
          </div>
          <div class="field">
            <label>Window</label>
            <input id="w" type="number" min="2" value="4" />
          </div>
          <button id="analyzeBtn">üîç Analyze</button>
          <button id="clearBtn" class="secondary">üßπ Clear</button>
        </div>
      </section>

      <section class="panes">
        <div class="pane">
          <h3>Code A</h3>
          <textarea id="codeA"></textarea>
          <div id="tokenA"></div>
        </div>
        <div class="pane">
          <h3>Code B</h3>
          <textarea id="codeB"></textarea>
          <div id="tokenB"></div>
        </div>
      </section>
    </div>

    <!-- Right slide-in panel -->
    <div class="right" id="result">
      <h3>üìä Analysis Result</h3>
      <canvas id="gaugeCanvas"></canvas>
      <div class="grid">
        <div class="card">
          <div class="label">Jaccard</div>
          <div id="jaccard" class="value">‚Äî</div>
        </div>
        <div class="card">
          <div class="label">Edit Similarity</div>
          <div id="edSim" class="value">‚Äî</div>
        </div>
        <div class="card">
          <div class="label">AST Structural</div>
          <div id="structSim" class="value">‚Äî</div>
        </div>
        <div class="card highlight">
          <div class="label">Final Score</div>
          <div id="score" class="value big">‚Äî</div>
        </div>
      </div>
      <div class="bar"><div id="barFill"></div></div>
      <pre id="msg" class="msg"></pre>
    </div>
  </main>

  <footer>
    <small>Made with ‚ù§Ô∏è in C++ & Flask ¬∑ ¬© 2025 CodePlag Analyzer</small>
  </footer>

  <script>
    const $ = (id) => document.getElementById(id);
    let editorA, editorB, gaugeChart;

    window.addEventListener("DOMContentLoaded", () => {
      editorA = CodeMirror.fromTextArea($("codeA"), {
        lineNumbers: true,
        mode: "text/x-c++src",
      });
      editorB = CodeMirror.fromTextArea($("codeB"), {
        lineNumbers: true,
        mode: "text/x-c++src",
      });

      editorA.on("change", updateTokenCounts);
      editorB.on("change", updateTokenCounts);

      $("analyzeBtn").addEventListener("click", analyze);
      $("clearBtn").addEventListener("click", clearFields);
      $("themeToggle").addEventListener("click", toggleTheme);

      if (localStorage.getItem("theme") === "light")
        document.body.classList.add("light");
    });

    function updateTokenCounts() {
      const tA = editorA.getValue().trim().split(/\s+/).filter(Boolean).length;
      const tB = editorB.getValue().trim().split(/\s+/).filter(Boolean).length;
      $("tokenA").textContent = `üß© Tokens: ${tA}`;
      $("tokenB").textContent = `üß© Tokens: ${tB}`;
    }

    async function analyze() {
      const codeA = editorA.getValue().trim(),
        codeB = editorB.getValue().trim();
      const k = parseInt($("k").value),
        w = parseInt($("w").value);
      const msg = $("msg"),
        bar = $("barFill");

      $("result").classList.add("active"); // slide-in
      msg.textContent = "üîÑ Running analysis...";
      bar.style.width = "10%";

      if (!codeA || !codeB) {
        msg.textContent = "‚ö†Ô∏è Enter both codes.";
        return;
      }

      try {
        const res = await fetch("/compare", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ codeA, codeB, k, window: w }),
        });

        const data = await res.json();
        if (data.error) throw new Error(data.error);

        const j = (data.jaccard || 0) * 100,
          e = (data.editSim || 0) * 100,
          s = (data.structSim || 0) * 100;
        const score = (data.score || data.jaccard || 0) * 100;

        $("jaccard").textContent = j.toFixed(2) + "%";
        $("edSim").textContent = e.toFixed(2) + "%";
        $("structSim").textContent = s.toFixed(2) + "%";

        animateScore(score);
        updateGauge(score);

        msg.textContent = data.message || "‚úÖ Analysis complete.";
        bar.style.width = Math.min(100, score) + "%";
      } catch (err) {
        msg.textContent = "‚ùå Error: " + err.message;
        bar.style.width = "0%";
      }
    }

    // Animated score counting
    function animateScore(score) {
      const el = $("score");
      let current = 0;
      const step = Math.max(1, Math.floor(score / 60));
      const interval = setInterval(() => {
        current += step;
        if (current >= score) {
          current = score;
          clearInterval(interval);
        }
        el.textContent = current.toFixed(0) + "%";
      }, 20);
    }

    function updateGauge(score) {
      const ctx = $("gaugeCanvas").getContext("2d");
      if (gaugeChart) gaugeChart.destroy();
      gaugeChart = new Chart(ctx, {
        type: "doughnut",
        data: {
          datasets: [
            {
              data: [score, 100 - score],
              backgroundColor: ["#22c55e", "#374151"],
              borderWidth: 0,
            },
          ],
        },
        options: {
          cutout: "75%",
          plugins: {
            tooltip: { enabled: false },
            legend: { display: false },
            beforeDraw(chart) {
              const {
                ctx,
                chartArea: { width, height },
              } = chart;
              ctx.save();
              ctx.font = "bold 22px Inter";
              ctx.fillStyle = "#ffffff";
              ctx.textAlign = "center";
              ctx.textBaseline = "middle";
              ctx.fillText(Math.round(score) + "%", width / 2, height / 1.7);
              ctx.restore();
            },
          },
        },
      });
    }

    function clearFields() {
      editorA.setValue("");
      editorB.setValue("");
      $("result").classList.remove("active"); // slide-out
      $("barFill").style.width = "0%";
      $("msg").textContent = "";
      updateTokenCounts();
    }

    function toggleTheme() {
      document.body.classList.toggle("light");
      localStorage.setItem(
        "theme",
        document.body.classList.contains("light") ? "light" : "dark"
      );
    }
  </script>
</body>
</html>
